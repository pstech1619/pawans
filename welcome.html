<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Welcome</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --overlay: rgba(0,0,0,0.35);
  --glow: #ff7200;
  --glow-dark: #b64300;
  --icon-size: 56px;
  --card-max: 1100px;
  --accent: rgba(255,114,0,0.95);
}

/* Reset / base */
*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; padding:0; font-family:'Poppins',sans-serif; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
body{
  background-image: url("2.jpg");
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
  color:#fff;
  position:relative;
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
}
body::before{
  content:"";
  position:absolute;
  inset:0;
  background:var(--overlay);
  z-index:0;
  pointer-events:none;
}
.page{ position:relative; z-index:1; min-height:100vh; padding-bottom:160px; }

/* ================= LOGO ================= */
.logoContainer{
  position:absolute;
  top:18px;
  left:18px;
  z-index:140;
  display:flex;
  align-items:center;
  gap:12px;
}

.logoLink{ display:flex; align-items:center; text-decoration:none; }

.logoBox{
  position:relative;
  width:80px;
  height:80px;
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
}
.ringGlow{
  position:absolute;
  width:100px;
  height:100px;
  border-radius:50%;
  background:radial-gradient(circle, rgba(255,114,0,0.55), rgba(255,114,0,0));
  filter:blur(14px);
  z-index:-2;
}
.ring{
  position:absolute;
  width:84px;
  height:84px;
  border-radius:50%;
  border:4px solid transparent;
  border-top-color:#ff7200;
  border-right-color:#ff4800;
  border-bottom-color:#ff7200;
  border-left-color:#ff4800;
  filter: drop-shadow(0 0 16px rgba(255,114,0,0.95));
  animation: rotateRing 6s linear infinite;
  z-index:-1;
}
.logoInside{
  width:70px;
  height:70px;
  border-radius:50%;
  object-fit:cover;
  display:block;
  box-shadow: 0 4px 18px rgba(0,0,0,0.45);
  transition: transform .28s ease, box-shadow .28s ease;
  z-index:2;
}
.logoBox:hover .logoInside{ transform: scale(1.06); box-shadow: 0 14px 38px rgba(255,114,0,0.14); }

.brandName{
  font-size:18px;
  font-weight:700;
  color:#fff;
  text-shadow: 0 0 10px rgba(255,114,0,0.9);
}

.logoContainer{ z-index:9999; pointer-events:auto; }

 /* ================= HERO + CARD ================= */
.hero{
  display:flex;
  align-items:center;
  justify-content:center;
  padding:56px 20px 20px 20px; 
  z-index:1;
}

.centerCardWrap{ width:min(var(--card-max), 94%); margin: 24px auto; }

.centerCard{
  position: relative;
  width:100%;
  border-radius:14px;
  padding:28px;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
  backdrop-filter: blur(6px) saturate(120%);
  overflow:visible;
  z-index:10;
  display:flex;
  gap:18px;
  align-items:center;
  justify-content:space-between;
  transition: transform .35s ease, box-shadow .35s ease, background .35s ease;
}
.centerCard:hover,
.centerCard.touched {
  transform: translateY(-10px) scale(1.02);
  box-shadow: 0 25px 60px rgba(255,114,0,0.25), 0 10px 25px rgba(0,0,0,0.45);
  background: rgba(255,255,255,0.07);
}
.centerCard::before{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius:18px;
  background: rgba(255,114,0,0.12);
  filter:blur(22px);
  z-index:-1;
}

.left{ flex:1 1 auto; min-width:0; }
.cardHead{ display:flex; gap:16px; align-items:flex-start; }
.thumbSmall{ width:84px; height:64px; border-radius:8px; overflow:hidden; flex-shrink:0; box-shadow:0 8px 30px rgba(0,0,0,0.45); }
.thumbSmall img{ width:100%; height:100%; object-fit:cover; display:block; }

.cardTitle{ font-size: clamp(20px, 2.7vw, 32px); font-weight:700; margin:0 0 8px 0; line-height:1.05; }
.cardDesc{ margin:0; color: rgba(255,255,255,0.92); font-size:16px; }

.cardFooter{ margin-top:18px; display:flex; gap:12px; flex-wrap:wrap; }
.btn{ padding:10px 18px; border-radius:10px; color:#fff; font-weight:600; text-decoration:none; background: linear-gradient(90deg,var(--glow),var(--glow-dark)); box-shadow: 0 10px 30px rgba(255,114,0,0.16); }

.smallThumbs{ display:flex; gap:12px; flex-shrink:0; align-items:center; justify-content:center; }
.smallThumbs img{
  width:150px;
  max-width:40vw;
  height:auto;
  border-radius:14px;
  box-shadow:0 0 25px rgba(255,114,0,0.6);
  display:block;
}

/* ================= ABOUT + COMMENTS ================= */
#about{
  width:min(var(--card-max), 94%);
  margin: 36px auto;
  padding: 28px;
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  backdrop-filter: blur(6px);
  box-shadow: 0 10px 40px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.02);
  position: relative;
}
#about h3{ margin:0 0 8px 0; font-size:22px; color:#fff; }
#about p{ margin:0 0 16px 0; color:rgba(255,255,255,0.9); line-height:1.6; }

.comment-area{
  margin-top:18px;
  display:grid;
  gap:12px;
}
.comment-area input[type="text"],
.comment-area textarea{
  width:100%;
  padding:12px 14px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.06);
  background: rgba(0,0,0,0.35);
  color:#fff;
  resize:vertical;
  outline:none;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
}
.comment-area textarea{ min-height:100px; max-height:240px; }

.comment-actions{ display:flex; gap:12px; align-items:center; }
.btn-ghost{
  padding:10px 16px;
  border-radius:8px;
  background:transparent;
  border:1px solid rgba(255,255,255,0.08);
  color:#fff;
  cursor:pointer;
}
.btn-submit{
  padding:10px 16px;
  border-radius:8px;
  background: linear-gradient(90deg,var(--glow),var(--glow-dark));
  color:#fff;
  cursor:pointer;
  border:none;
}

#commentsList{ margin-top:18px; display:flex; flex-direction:column; gap:12px; }
.comment{
  padding:12px 14px;
  border-radius:8px;
  background: rgba(0,0,0,0.28);
  border:1px solid rgba(255,255,255,0.03);
  box-shadow: 0 8px 20px rgba(0,0,0,0.35);
}
.comment .meta{ font-size:13px; color:rgba(255,255,255,0.7); margin-bottom:6px; }
.comment .text{ color:#fff; line-height:1.5; }

/* ================= SOCIAL ICONS BOTTOM ================= */
#social-bottom{
  position:fixed;
  left:0;
  right:0;
  bottom:20px;
  display:flex;
  justify-content:center;
  z-index:200;
  pointer-events:none;
}
.social-box{ display:flex; gap:20px; pointer-events:auto; }

.i{
  width:var(--icon-size);
  height:var(--icon-size);
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:14px;
  font-size:22px;
  color:#fff;
  text-decoration:none;
  position:relative;
  background: rgba(255,255,255,0.04);
  transition: transform .26s ease, box-shadow .26s ease;
  cursor:pointer;
}
.i::before{
  content:"";
  position:absolute;
  inset:-6px;
  border-radius:18px;
  background:linear-gradient(90deg,#ff7200,#ffd37d,#ff7200);
  filter:blur(12px);
  opacity:0.7;
  z-index:-2;
}
.i::after{
  content:"";
  position:absolute;
  inset:-3px;
  border-radius:14px;
  background:rgba(255,255,255,0.04);
  z-index:-1;
  filter:blur(2px);
}
.insta::before{ background:linear-gradient(45deg,#f58529,#dd2a7b,#8134af); }
.tele::before{ background:linear-gradient(45deg,#00a2ff,#0088cc); }
.tw::before{ background:linear-gradient(45deg,#00acee,#0077b5); }
.yt::before{ background:linear-gradient(45deg,#ff0000,#ff4b4b); }
.i:hover{ transform:translateY(-8px) scale(1.08); box-shadow:0 20px 60px rgba(255,114,0,0.2); }

@keyframes rotateRing{ 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }
@keyframes spinBorder{ 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }

@media (prefers-reduced-motion: reduce){
  .ring { animation: none !important; }
  .centerCard, .centerCard.touched, .centerCard:hover { transition: none !important; transform: none !important; }
}

@media (max-width:920px){
  .smallThumbs img{ width:140px; }
}
@media (max-width:560px){
  .logoBox{ width:64px; height:64px; }
  .ring{ width:68px; height:68px; border-width:3px; }
  .ringGlow{ width:80px; height:80px; filter:blur(10px); }
  .logoInside{ width:56px; height:56px; }

  .brandName{ font-size:16px; margin-top:2px; }
  .logoContainer{ top:12px; left:12px; gap:8px; }

  .centerCard{ flex-direction:column; gap:14px; padding:20px; }
  .smallThumbs{ order:2; width:100%; display:flex; justify-content:center; }
  .smallThumbs img{ width:54vw; max-width:260px; }

  #about{ padding:18px; margin:20px auto; }
  .comment-area textarea{ min-height:90px; }
}

/* =================== CHATBOT STYLES (ADDED) =================== */
/* ---------- neon ring + bigger ---------- */
.chat-toggle-btn{
  position:fixed;
  right:20px;
  bottom:96px;
  z-index:99999;
  width:76px;
  height:76px;
  border-radius:50%;
  background: radial-gradient(circle at 35% 25%, #ffffff14, transparent 30%), linear-gradient(90deg,var(--glow),var(--glow-dark));
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  cursor:pointer;
  border:none;
  backdrop-filter: blur(4px);
  box-shadow:
    0 6px 18px rgba(255,114,0,0.14),
    0 0 30px rgba(255,114,0,0.12);
  transition: transform .18s ease, box-shadow .18s ease;
  overflow: visible;
  padding:0;
}

/* animated neon ring (behind button) */
.chat-toggle-btn::before{
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%,-50%);
  width: 110px;
  height: 110px;
  border-radius: 50%;
  background: conic-gradient(from 0deg, #ff9a3c, #ff4b00, #ffd37d, #ff9a3c);
  filter: blur(10px) saturate(140%);
  opacity: 0.95;
  z-index: -2;
  animation: neonRotate 6.5s linear infinite;
  pointer-events: none;
}

/* subtle inner halo for depth */
.chat-toggle-btn::after{
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%,-50%);
  width: 86px;
  height: 86px;
  border-radius:50%;
  background: radial-gradient(circle, rgba(255,255,255,0.06), rgba(255,255,255,0));
  z-index: -1;
  filter: blur(2px);
  pointer-events: none;
}

/* inside content wrapper: changed to row so avatar + text sit side-by-side */
.chat-toggle-inner{
  display:flex;
  flex-direction:row;
  align-items:center;
  justify-content:center;
  gap:8px;
  width:auto;
  height:56px;
  pointer-events:none; /* click should go to button */
}

/* avatar inside small circle */
.chat-toggle-inner .mini-avatar{
  width:44px;
  height:44px;
  border-radius:50%;
  overflow:hidden;
  flex:0 0 44px;
  display:block;
  box-shadow: 0 6px 16px rgba(0,0,0,0.35);
  border:2px solid rgba(255,255,255,0.06);
}
.chat-toggle-inner .mini-avatar img{ width:100%; height:100%; object-fit:cover; display:block; }

/* side text */
.chat-toggle-inner .side-text{
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  justify-content:center;
  pointer-events:none;
}
.chat-toggle-inner .side-text .bold{
  font-size:11px;
  font-weight:700;
  line-height:1;
  color:#fff;
  text-shadow:0 2px 8px rgba(0,0,0,0.6);
}
.chat-toggle-inner .side-text .sub{
  font-size:10px;
  font-weight:600;
  line-height:1;
  opacity:0.95;
  color:#fff;
  margin-top:2px;
}

/* hide on very small screens to avoid crowding */
@media (max-width:420px){
  .chat-toggle-inner .side-text{ display:none; }
}

/* hover / press */
.chat-toggle-btn:hover{ transform: translateY(-6px) scale(1.04); box-shadow: 0 18px 48px rgba(255,114,0,0.28); }
.chat-toggle-btn:active{ transform: translateY(-2px) scale(.99); }

@keyframes neonRotate{
  0%{ transform: translate(-50%,-50%) rotate(0deg); }
  100%{ transform: translate(-50%,-50%) rotate(360deg); }
}

.chat-window{
  position:fixed;
  right:22px;
  bottom:170px;
  z-index:99998;
  width:360px;
  max-width:92vw;
  height:480px;
  max-height:84vh;
  border-radius:12px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  background: linear-gradient(180deg, rgba(10,10,10,0.95), rgba(6,6,6,0.95));
  box-shadow: 0 25px 60px rgba(0,0,0,0.6);
  border:1px solid rgba(255,255,255,0.04);
  transform: translateY(12px);
  transition: all .25s ease;
}
.chat-window.hidden{ opacity:0; visibility:hidden; transform: translateY(20px) scale(.98); pointer-events:none; }
.chat-header{
  padding:12px 14px;
  display:flex;
  align-items:center;
  gap:10px;
  border-bottom:1px solid rgba(255,255,255,0.03);
}
.chat-header .title{ font-weight:700; font-size:15px; color:#fff; }
.chat-header .subtitle{ font-size:12px; color:rgba(255,255,255,0.7); }
.chat-messages{
  padding:12px;
  flex:1 1 auto;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
}
.msg{
  max-width:82%;
  padding:10px 12px;
  border-radius:10px;
  font-size:14px;
  line-height:1.4;
  box-shadow: 0 6px 18px rgba(0,0,0,0.45);
}
.msg.user{ align-self:flex-end; background: linear-gradient(90deg,#2b2b2b,#1f1f1f); color:#fff; border:1px solid rgba(255,255,255,0.03); }
.msg.bot{ align-self:flex-start; background: rgba(255,255,255,0.04); color:#fff; border:1px solid rgba(255,255,255,0.03); }
.chat-input{
  padding:10px;
  display:flex;
  gap:8px;
  border-top:1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.55));
}
.chat-input input{
  flex:1 1 auto;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.02);
  color:#fff;
  outline:none;
}
.chat-input button{
  padding:8px 12px;
  border-radius:10px;
  border:none;
  background: linear-gradient(90deg,var(--glow),var(--glow-dark));
  color:#fff;
  cursor:pointer;
}

.typing{
  display:inline-block;
  font-size:0;
}
.typing span{
  display:inline-block;
  width:6px;
  height:6px;
  margin:0 2px;
  background:#fff;
  border-radius:50%;
  opacity:0.25;
  animation: blink 1s infinite;
}
.typing span:nth-child(2){ animation-delay:.15s; }
.typing span:nth-child(3){ animation-delay:.3s; }
@keyframes blink{ 0%{opacity:.25} 50%{opacity:1} 100%{opacity:.25} }

.chat-close{
  margin-left:auto;
  background:transparent;
  border:none;
  color:rgba(255,255,255,0.8);
  cursor:pointer;
  font-size:16px;
}

@media (max-width:520px){
  .chat-window{ right:12px; left:12px; width:auto; bottom:120px; height:60vh; }
  .chat-toggle-btn{ right:12px; bottom:70px; }
}
</style>
</head>

<body>
  <div class="page">

    <div class="logoContainer">
      <a class="logoLink" href="https://www.youtube.com/@Pstechnology1" target="_blank" aria-label="Open YouTube">
        <div class="logoBox" title="P Technology">
          <div class="ringGlow"></div>
          <div class="ring"></div>
          <img class="logoInside" src="logo.png" alt="P Technology logo">
        </div>
      </a>
      <div class="brandName">P Technology</div>
    </div>

    <main class="hero">
      <div class="centerCardWrap">
        <section class="centerCard" aria-label="Featured courses">

          <div class="left">
            <div class="cardHead">
              <div class="thumbSmall"><img src="2.jpg" alt=""></div>
              <div>
                <h2 class="cardTitle">Featured Video & Live Batches</h2>
                <p class="cardDesc">Explore our tech content, tutorials, courses & more. Join live batches or self-paced courses â€” special discounts available today.</p>
              </div>
            </div>

            <div class="cardFooter" style="margin-top:18px;">
              <a class="btn" href="https://www.youtube.com/@Pstechnology1" target="_blank">Watch Now</a>
              <a class="btn" href="https://www.instagram.com/pstechnology01/" target="_blank" style="background:transparent;border:1px solid rgba(255,255,255,0.12)">Explore</a>
            </div>
          </div>

          <div class="smallThumbs" aria-hidden="true">
            <img src="3.png" alt="Profile Photo">
          </div>

        </section>
      </div>
    </main>

    <main class="hero" style="margin-top:-80px;">
      <div class="centerCardWrap">
        <section class="centerCard" aria-label="More courses">

          <div class="left">
            <div class="cardHead">
              <div class="thumbSmall"><img src="2.jpg" alt=""></div>
              <div>
                <h2 class="cardTitle">More Courses & Tutorials</h2>
                <p class="cardDesc">Learn web dev, editing, freelancing, AI tools & more. New videos and live sessions posted regularly.</p>
              </div>
            </div>

            <div class="cardFooter" style="margin-top:18px;">
              <a class="btn" href="https://www.youtube.com/@Pstechnology1" target="_blank">Watch Now</a>
              <a class="btn" href="https://www.instagram.com/pstechnology01/" target="_blank" style="background:transparent;border:1px solid rgba(255,255,255,0.12)">Explore</a>
            </div>
          </div>

          <div class="smallThumbs" aria-hidden="true">
            <img src="3.png" alt="Profile Photo">
          </div>

        </section>
      </div>
    </main>

    <section id="about" aria-label="About and Comments">
      <h3>About P Technology</h3>
      <p>
        P Technology provides practical tech training â€” from web development to data tools and AI workflows.
        We publish tutorials, run live batches, and share real-world projects so learners can build portfolios and get jobs.
      </p>

      <div class="comment-area" aria-label="Comment form">
        <input type="text" id="commentName" placeholder="Your name (optional)">
        <textarea id="commentText" placeholder="Write your comment..."></textarea>

        <div class="comment-actions">
          <button class="btn-ghost" id="clearBtn" type="button">Clear</button>
          <button class="btn-submit" id="submitBtn" type="button">Post Comment</button>
        </div>

        <div id="commentsList" aria-live="polite"></div>
      </div>
    </section>

    <div id="social-bottom">
      <div class="social-box" role="navigation" aria-label="Social links">
        <a class="i insta" href="https://www.instagram.com/pstechnology01/" target="_blank" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
        <a class="i tele" href="https://t.me/techwithtips0" target="_blank" aria-label="Telegram"><i class="fa-brands fa-telegram"></i></a>
        <a class="i tw" href="#" target="_blank" aria-label="X / Twitter"><i class="fa-brands fa-x-twitter"></i></a>
        <a class="i yt" href="https://www.youtube.com/@tipswithearn01" target="_blank" aria-label="YouTube"><i class="fa-brands fa-youtube"></i></a>
      </div>
    </div>

    <!-- ================= CHATBOT WIDGET (ADDED) ================= -->
    <!-- Changed only the chat-toggle button content: avatar + side text "i am ai assistant of ps Tech" -->
    <button class="chat-toggle-btn" id="chatToggle" aria-label="Open chat" title="Chat with P Technology">
      <div class="chat-toggle-inner" aria-hidden="true">
        <span class="mini-avatar" aria-hidden="true">
          <img src="4.jpg" alt="assistant avatar">
        </span>
        <span class="side-text" aria-hidden="true">
          <span class="bold">i am ai assistant</span>
          <span class="sub">of ps Tech</span>
        </span>
      </div>
      <span class="sr-only" style="position:absolute;left:-9999px">Open chat</span>
    </button>

    <div class="chat-window hidden" id="chatWindow" role="dialog" aria-label="Chat with P Technology">
      <div class="chat-header">
        <div>
          <div class="title">P Technology Chatbot</div>
          <div class="subtitle">Ask about courses, schedules or links</div>
        </div>
        <button class="chat-close" id="chatClose" aria-label="Close chat"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="chat-messages" id="chatMessages" aria-live="polite" aria-atomic="false">
        <div class="msg bot">Namaste! Main P Technology ka assistant hoon. Aap kya janna chahenge? (e.g., "courses", "live batches", "YouTube", "Instagram")</div>
      </div>

      <div class="chat-input">
        <input id="chatInput" type="text" placeholder="Type your message..." aria-label="Type message">
        <button id="chatSend" aria-label="Send"><i class="fa-solid fa-paper-plane"></i></button>
      </div>
    </div>

  </div>

<!-- Firebase (compat libs for direct browser use) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
/* ================= Firebase configuration (from you) ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBwC35sh20ttnUeNsMOi8ghzsab-Db_6c4",
  authDomain: "pawan-9dd64.firebaseapp.com",
  databaseURL: "https://pawan-9dd64-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "pawan-9dd64",
  storageBucket: "pawan-9dd64.firebasestorage.app",
  messagingSenderId: "261645960158",
  appId: "1:261645960158:web:69b39c9ac9e132c1ef134f",
  measurementId: "G-2SM29D8FGW"
};

// init firebase app + realtime database
try {
  firebase.initializeApp(firebaseConfig);
  var database = firebase.database();
} catch(e) {
  console.warn('Firebase init failed', e);
  var database = null;
}

/* ================= Comment system (Realtime DB, fallback to localStorage) ================= */
const nameEl = document.getElementById('commentName');
const textEl = document.getElementById('commentText');
const submitBtn = document.getElementById('submitBtn');
const commentsList = document.getElementById('commentsList');
const clearBtn = document.getElementById('clearBtn');

function renderCommentDOM(c){
  const wrap = document.createElement('div');
  wrap.className = 'comment';
  const meta = document.createElement('div');
  meta.className = 'meta';
  const name = c.name ? c.name : 'Anonymous';
  const date = c.time ? new Date(c.time) : new Date();
  meta.textContent = name + ' â€¢ ' + date.toLocaleString();
  const txt = document.createElement('div');
  txt.className = 'text';
  txt.textContent = c.text;
  wrap.appendChild(meta);
  wrap.appendChild(txt);
  return wrap;
}

function appendCommentToList(c) {
  commentsList.insertBefore(renderCommentDOM(c), commentsList.firstChild);
}

/* Local storage helpers (fallback) */
function saveLocalComment(obj){
  const raw = localStorage.getItem('pt_comments');
  const arr = raw ? JSON.parse(raw) : [];
  arr.unshift(obj);
  localStorage.setItem('pt_comments', JSON.stringify(arr.slice(0,50)));
}

function loadLocalComments(){
  const raw = localStorage.getItem('pt_comments');
  if(!raw) return;
  try{
    const arr = JSON.parse(raw);
    commentsList.innerHTML = '';
    arr.forEach(c => commentsList.appendChild(renderCommentDOM(c)));
  }catch(e){
    console.error(e);
  }
}

/* Realtime DB: push comment */
function pushCommentToFirebase(obj){
  if(!database) return Promise.reject('no-db');
  const ref = database.ref('comments');
  return ref.push(obj);
}

/* Realtime DB: listen for new comments */
function startRealtimeListener(){
  if(!database) return;
  const ref = database.ref('comments').limitToLast(50);
  ref.off(); // remove previous if any
  ref.on('child_added', snapshot => {
    const val = snapshot.val();
    if(!val) return;
    appendCommentToList(val);
  });
}

/* Submit handling */
submitBtn.addEventListener('click', () => {
  const text = textEl.value.trim();
  if(!text){
    alert('Please write a comment before posting.');
    return;
  }
  const obj = { name: nameEl.value.trim(), text, time: Date.now() };

  if(database){
    pushCommentToFirebase(obj)
      .then(()=> {
        saveLocalComment(obj);
        nameEl.value = '';
        textEl.value = '';
        textEl.blur();
      })
      .catch(err => {
        console.warn('Push failed, saving locally', err);
        saveLocalComment(obj);
        commentsList.insertBefore(renderCommentDOM(obj), commentsList.firstChild);
        nameEl.value = '';
        textEl.value = '';
      });
  } else {
    saveLocalComment(obj);
    commentsList.insertBefore(renderCommentDOM(obj), commentsList.firstChild);
    nameEl.value = '';
    textEl.value = '';
    textEl.blur();
  }
});

/* Clear button */
clearBtn.addEventListener('click', () => {
  nameEl.value = '';
  textEl.value = '';
});

/* initial load: show firebase comments if possible else local */
if(database){
  database.ref('comments').limitToLast(50).once('value')
    .then(snapshot => {
      commentsList.innerHTML = '';
      snapshot.forEach(child => {
        const v = child.val();
        commentsList.appendChild(renderCommentDOM(v));
      });
      startRealtimeListener();
    })
    .catch(err => {
      console.warn('firebase read failed, using local', err);
      loadLocalComments();
    });
} else {
  loadLocalComments();
}

/* ========== Touch behaviour for card lift ========== */
(function(){
  const cards = document.querySelectorAll('.centerCard');
  if(!cards) return;
  cards.forEach(card=>{
    card.addEventListener('touchstart', function _onStart(e){
      this.classList.add('touched');
    }, {passive:true});
    card.addEventListener('touchend', function _onEnd(e){
      setTimeout(()=> this.classList.remove('touched'), 250);
    }, {passive:true});
    card.addEventListener('touchcancel', function _onCancel(e){
      this.classList.remove('touched');
    }, {passive:true});
  });
})();

/* ================= CHATBOT LOGIC (LOCAL, RULE-BASED) ================= */
(function(){
  const chatToggle = document.getElementById('chatToggle');
  const chatWindow = document.getElementById('chatWindow');
  const chatClose = document.getElementById('chatClose');
  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const chatSend = document.getElementById('chatSend');

  function openChat(){
    chatWindow.classList.remove('hidden');
    chatToggle.style.transform = 'scale(.95)';
    setTimeout(()=> chatToggle.style.transform = '', 200);
    chatInput.focus();
  }
  function closeChat(){
    chatWindow.classList.add('hidden');
  }

  chatToggle.addEventListener('click', () => {
    if(chatWindow.classList.contains('hidden')) openChat();
    else closeChat();
  });
  chatClose.addEventListener('click', closeChat);

  function appendMessage(text, who = 'bot', extraHTML){
    const d = document.createElement('div');
    d.className = 'msg ' + (who === 'user' ? 'user' : 'bot');
    if(extraHTML){
      d.innerHTML = extraHTML;
    } else {
      d.textContent = text;
    }
    chatMessages.appendChild(d);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    return d;
  }

  function botReply(userText){
    const t = (userText || '').toLowerCase();

    if(/^(hi|hii|hello|namaste|hey)\b/.test(t)) {
      return "Hello! ðŸ‘‹ Main aapki kaise madad kar sakta hoon? Aap pooch sakte hain: 'courses', 'live batches', 'YouTube', 'Instagram'.";
    }
    if(t.includes('course') || t.includes('courses') || t.includes('web dev') || t.includes('tutorial')) {
      return "Hum web development, editing, freelancing, AI tools aur data related courses dete hain. YouTube par free tutorials bhi mil jayenge â€” ya live batches join kar sakte hain.";
    }
    if(t.includes('live') || t.includes('batch')) {
      return "Live batches ke schedule ke liye YouTube channel par check karein ya Instagram par DM karein. Kya main YouTube link bhejun? (type: 'youtube')"
    }
    if(t.includes('youtube')) {
      return "YouTube channel: https://www.youtube.com/@Pstechnology1 â€” yahan par latest tutorials aur live sessions milenge.";
    }
    if(t.includes('instagram') || t.includes('insta')) {
      return "Instagram: https://www.instagram.com/pstechnology01/ â€” wahan par updates aur short clips post karte hain.";
    }
    if(t.includes('portfolio') || t.includes('job') || t.includes('placement')) {
      return "Courses me projects aur portfolio building cover hota hai â€” job support depend karta hai batch par. Hum real-world projects dete hain jise aap showcase kar sakte hain.";
    }
    if(t.includes('help') || t.includes('how')) {
      return "Aap specific sawal pooch sakte hain (e.g., 'How to join live batch?', 'Course fees?', 'Best course for beginners?'). Main answer dunga ya direct link bhej dunga.";
    }

    const fallback = [
      "Mujhe maaf kijiye, main is sawal ka seedha jawab nahi de paaya. Thoda aur specific bataiye?",
      "Woh bahut achha sawaal hai â€” thoda aur detail den to main madad kar sakta hoon.",
      "Aap 'YouTube' ya 'Instagram' likh kar direct links le sakte hain."
    ];
    return fallback[Math.floor(Math.random()*fallback.length)];
  }

  function simulateReply(userText){
    const typingNode = document.createElement('div');
    typingNode.className = 'msg bot';
    typingNode.innerHTML = '<div class="typing"><span></span><span></span><span></span></div>';
    chatMessages.appendChild(typingNode);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    setTimeout(()=> {
      typingNode.remove();
      const reply = botReply(userText);
      const linkified = reply.replace(/(https?:\/\/[^\s]+)/g, function(url){
        return '<a href="' + url + '" target="_blank" rel="noopener noreferrer" style="color:inherit;text-decoration:underline;">' + url + '</a>';
      });
      appendMessage(null, 'bot', linkified);
    }, 700 + Math.min(2000, userText.length * 25));
  }

  function sendUser(){
    const v = chatInput.value.trim();
    if(!v) return;
    appendMessage(v, 'user');
    chatInput.value = '';
    chatInput.focus();
    simulateReply(v);
  }

  chatSend.addEventListener('click', sendUser);
  chatInput.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && !e.shiftKey){
      e.preventDefault();
      sendUser();
    }
  });

  chatInput.addEventListener('focus', () => {
    if(chatWindow.classList.contains('hidden')) openChat();
  });

  document.addEventListener('keydown', (e) => {
    if(e.key === 'Escape') {
      closeChat();
    }
  });

})();
</script>
</body>
</html>


